---
title: "周报"
tags: [thoughts]
---

始于 22.7.31

<!--more-->


<details>
  <summary>22.7.31 - 22.8.6</summary>

本周原计划是准备秋招，在周一干完了能应付一周的活后，周二突然来了个很急的需求，要求本周内完成，秋招的事就只能先放放了。

这个需求非常 CRUD，需要从服务器日志中解析出所有的用户 id，调用 rpc 接口去查询用户的更多数据，最后把数据通过 api 插入到 OLAP 数据库。

最终顺利在周五完成需求，事后总结有几点收获：

* 动态语言挺好用。setattr 能对库的类增加成员函数，减少很多冗余代码。不过对于其他语言，用 trait 也能满足我的需求
* 类型系统很重要，py 应该强制要求类型标注。内部库有一个函数调用类型匹配错误的 bug，该代码之前没被调用过，藏匿至今，不可思议。要是有类型标注，不致于此。想起之前跟面试官介绍 mypy 项目的被鄙夷的场面了
* 库函数向用户通知错误的方式，除了错误码就是抛出异常。这次的需求用 py2 编写，我采用抛出异常的方式，在主函数 catch 异常并写入日志，极大降低理清程序逻辑的心智负担，避免错误码层层传递，深刻感受到异常控制流的威力
* 以下代码并不等价
```
try:
    count += 1
except:
    count += 1
```

```
try:
    pass
except:
    pass
finally:
    count += 1
```
* 序列化反序列化意外地非常耗时。之前读 ddia 有这么一段话，大意是，内存数据库更快的原因不在于数据是存放在内存中，而是因为免去了数据打包解包的过程。如果内存足够大，基于磁盘的数据库也可以不需要磁盘 IO。当时将信将疑，现在总算见识到了
* 在思考业务的边界情况时，总结了一些方法论。比如函数的语义最好写成纯函数，逻辑性的 bug 通常出现在有副作用的变量上，需要着重关注有副作用变量经过的控制流，以及与该变量有关联的其他副作用变量。总结得还不太完善。我觉得形式化验证是不是就在关心这方面的工作，有空了解一下
* 公司内部的工具链太老了，吐槽已久。正好周一读了这篇[博文](https://xuanwo.io/reports/2022-25/)，有了更深的体会
</details>



